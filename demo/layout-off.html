<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DiagView - Off Layout</title>

    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <script src="https://unpkg.com/@panzoom/panzoom@4.5.1/dist/panzoom.min.js"></script>

    <!-- Styles -->
    <link rel="stylesheet" href="demo-styles.css">

    <!-- Primary: CDN (Online) -->
    <!-- <script src="https://cdn.jsdelivr.net/npm/diagview/dist/diagview.umd.min.js"></script> -->

    <!-- Offline Mode: Uncomment below to use local file -->
    <script src="../dist/diagview.umd.min.js"></script>


    <style>
        :root {
            --diagram-accent: #3b82f6;
        }

        body {
            padding-top: 100px;
        }

        .mermaid {
            display: flex;
            justify-content: center;
        }
    </style>

    <script>
        (function () {
            const savedTheme = localStorage.getItem('dv-theme');
            const savedColor = localStorage.getItem('dv-accent');

            if (savedTheme === 'dark') {
                document.documentElement.classList.add('dark');
            }

            if (savedColor) {
                document.documentElement.style.setProperty('--diagram-accent', savedColor);
                // Also set the library variable just in case
                document.documentElement.style.setProperty('--dv-accent', savedColor);
            }
        })();
    </script>
</head>

<body>

    <div class="controls">
        <div class="brand">
            <a href="index.html"
                style="text-decoration: none; color: inherit; display: flex; align-items: center; gap: 8px;">
                <span style="font-size: 1.5rem;">üè†</span>
                <div style="display: flex; flex-direction: column; line-height: 1.2;">
                    <span
                        style="font-size: 0.7rem; color: var(--diagram-accent); text-transform: uppercase; letter-spacing: 1px;">DiagView</span>
                    <span>Off Layout</span>
                </div>
            </a>
        </div>
        <div class="toggles">
            <label style="display:flex; align-items:center; gap:8px; font-size: 0.9rem; font-weight: 600;">
                Accent:
                <input type="color" id="accentPicker" value="#3b82f6">
            </label>
            <button class="toggle-btn" onclick="toggleTheme()" title="Toggle Dark/Light Mode">
                üåì
            </button>
            <a href="index.html" class="toggle-btn"
                style="text-decoration: none; background: var(--diagram-accent); color: white; border: none;">
                Back to Hub
            </a>
        </div>
    </div>

    <div style="max-width: 1200px; margin: 0 auto 40px; text-align: center;">
        <h1 style="font-size: 2.5rem; margin-bottom: 10px;">Off Layout (Stealth UI)</h1>
        <p style="color: var(--muted); font-size: 1.1rem;">The UI is completely hidden. The diagram itself acts as the
            trigger button. Perfect for seamless embeds.</p>
    </div>

    <div class="grid">
        <!-- Org Chart (SVG) -->
        <div class="card">
            <h2>Company Structure</h2>
            <div class="chart" data-title="Global Org Chart">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 600 400">
                    <defs>
                        <style>
                            .o-box {
                                fill: #4f46e5;
                                stroke: #4338ca;
                                stroke-width: 2;
                            }

                            .o-label {
                                fill: white;
                                font-family: sans-serif;
                                font-size: 12px;
                                text-anchor: middle;
                            }

                            .o-title {
                                font-weight: bold;
                                font-size: 14px;
                            }

                            .o-line {
                                stroke: #94a3b8;
                                stroke-width: 2;
                            }
                        </style>
                    </defs>
                    <rect class="o-box" x="250" y="20" width="100" height="60" rx="8" />
                    <text class="o-label o-title" x="300" y="45">CEO</text>
                    <text class="o-label" x="300" y="62">John Executive</text>
                    <line class="o-line" x1="300" y1="80" x2="300" y2="100" />
                    <line class="o-line" x1="150" y1="100" x2="450" y2="100" />
                    <line class="o-line" x1="150" y1="100" x2="150" y2="120" />
                    <line class="o-line" x1="450" y1="100" x2="450" y2="120" />
                    <rect class="o-box" x="100" y="120" width="100" height="60" rx="8" />
                    <text class="o-label o-title" x="150" y="145">CTO</text>
                    <rect class="o-box" x="400" y="120" width="100" height="60" rx="8" />
                    <text class="o-label o-title" x="450" y="145">CFO</text>
                </svg>
            </div>
            <p style="text-align: center; margin-top: 15px; color: var(--diagram-accent); font-weight: 500;">‚Üë Diagram
                is the trigger</p>
        </div>

        <!-- Complex (Mermaid) -->
        <div class="card">
            <h2>Complex Workflow</h2>
            <div class="mermaid" data-title="Stress Test">
                graph TD
                A[Start] --> B[Process A]
                B --> C{Success?}
                C -->|Yes| D[Finalize]
                C -->|No| E[Retry]
                E --> B
                D --> F[Send Email]
                F --> G[End]
            </div>
        </div>

        <!-- Performance Stress Test (SVG) -->
        <div class="card">
            <h2>Performance Stress Test</h2>
            <div class="stress-test" data-title="2,500 Nodes Test">
                <svg id="stress-svg" width="3000" height="3000" viewBox="0 0 3000 3000"
                    xmlns="http://www.w3.org/2000/svg">
                    <rect width="100%" height="100%" fill="transparent" />
                    <g id="stress-node-layer"></g>
                </svg>
            </div>
            <p style="text-align: center; margin-top: 10px; color: var(--muted); font-size: 0.8rem;">Click to open the
                2,500 node grid</p>
        </div>
    </div>

    <script>
        // 1. Initialize Picker State
        const picker = document.getElementById('accentPicker');
        const savedColor = localStorage.getItem('dv-accent');
        if (savedColor) picker.value = savedColor;

        // 2. Initialize Mermaid
        mermaid.initialize({ startOnLoad: true, theme: 'default' });

        // 3. Initialize DiagView
        document.addEventListener('DOMContentLoaded', async () => {
            // Generate Stress Test Nodes
            const stressLayer = document.getElementById('stress-node-layer');
            if (stressLayer) {
                for (let r = 0; r < 50; r++) {
                    for (let c = 0; c < 50; c++) {
                        const g = document.createElementNS("http://www.w3.org/2000/svg", "g");
                        g.setAttribute("class", "node");
                        const x = c * 60;
                        const y = r * 60;
                        g.innerHTML = `<rect x="${x}" y="${y}" width="40" height="30" rx="4" fill="#10b981" fill-opacity="0.1" stroke="#10b981" stroke-width="1"/>`;
                        stressLayer.appendChild(g);
                    }
                }
            }

            if (window.mermaid) await mermaid.run();

            DiagView.init({
                diagramSelector: '.diagram, .chart, .mermaid, .stress-test, [data-diagram]',
                showKeyboardHelp: true,
                highResScale: 4,
                accentColor: localStorage.getItem('dv-accent') || null,
                layout: 'off',
            });
        });

        // 4. Persistence Logic

        function toggleTheme() {
            const isDark = document.documentElement.classList.toggle('dark');
            localStorage.setItem('dv-theme', isDark ? 'dark' : 'light');
        }

        picker.addEventListener('input', (e) => {
            const color = e.target.value;
            // Apply
            document.documentElement.style.setProperty('--diagram-accent', color);
            document.documentElement.style.setProperty('--dv-accent', color);
            // Save
            localStorage.setItem('dv-accent', color);
        });

    </script>
</body>

</html>
